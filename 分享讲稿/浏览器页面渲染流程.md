![render-pipeline](assets/render-pipeline.png)



按照渲染的时间顺序，流水线可分为如下几个子阶段：**构建 DOM 树**、**样式计算**、**布局阶段**、**分层**、**绘制**、**分块**、**光栅化**和**合成**。

下面，我们通过**输入内容**，**处理过程**，**输出内容**这三个方面去理解每个子阶段。

&emsp;

#### 构建 DOM 树

因为浏览器无法直接理解和使用 HTML，所以需要将 HTML 转换为浏览器能够理解的结构——DOM 树。 

![DOM-construct-process](assets/DOM-construct-process.png)

&emsp;

 #### 样式计算

样式计算大体可分为三步来完成：

1. 把 CSS 转换为浏览器能够理解的结构 （CSSOM，体现在 DOM 中就是 document.styleSheets）

2. 转换样式表中的属性值，使其标准化

   ![css-attribute-value-standardizing](assets/css-attribute-value-standardizing.png)

   

3. 计算出 DOM 树中每个节点的具体样式 

样式计算的目的是为了计算出 DOM 树中每个节点的具体样式，在计算过程中需要遵守 CSS 的继承和层叠两个规则。最终输出的内容是每个 DOM 节点的样式，并被保存在 ComputedStyle 内。

&emsp;

#### 布局阶段

布局阶段计算出 DOM 树中可见元素的几何位置 ，分成两步：创建布局树、布局计算

1. 创建布局树

   ![construct-layout-tree](assets/construct-layout-tree.png)

   遍历 DOM 树中的所有节点，并把可见节点加到布局树中，而不可见的节点会被布局树忽略掉，如 head 标签下面的全部内容，再比如 body.p.span 这个元素，因为它的属性包含 dispaly:none，所以这个元素也没有被包进布局树。

   &emsp; 

2. 布局计算