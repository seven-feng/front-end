物联网应用快速构建

简介：通过可视化拖拽、配置的方式，方便地将各种组件与设备相关的数据源关联，无需编程，即可快速搭建物联网场景下的 web 应用。

案例：设备控制面板、设备监控大屏

我司主要想构建设备监控页面，包括设备列表、设备地图等

分析：

1. 说到底，就是一个可视化搭建系统（工具），提供应用和服务开发的能力。
2. 通过页面组件化，将页面的搭建转变成组件的可视化组合，页面内容的编辑转化为对组件的配置字段（属性、数据）修改，提升页面编辑效率
3. 右侧配置区域由组件 schema 定义，props 定义展示，models 表示默认数据
4. 预览：将数据库里保存的数据，配合组件渲染出来。直接客户端渲染即可
5. 发布：页面搭建完成——>生成 Json 数据——>保存到数据库——>SSR 渲染生成静态 HTML——>通过指定的路由进行访问



> 组件 schema：定义组件的可配置项，可用于生成右侧配置区域。
>
> 它与 json schema 的作用类似，不过 json schema 是用来定义 json 数据的格式的。



难点：年前的物联网应用快速构建项目中的工作台，采用了 HTML 编辑 + 页面 Data 编辑，对于不同的功能模块，我用 if else 分别去渲染，代码冗余，扩展性很差，右侧属性面板也是一样。

计划重新设计一个编辑器界面，采用 Component Tree 编辑 + 页面 Data 编辑，组件实现了对 HTML 元素、元素布局和样式、业务逻辑的封装，通过组件化的方式，将页面的搭建转化为对组件的组合，大大降低了页面生成的编辑工作量，实现承载业务逻辑的页面的快速搭建。还想通过组件 schema 生成右侧配置面板。



描述

物联网应用快速构建，这是一个可视化搭建系统，提供了应用和服务开发的能力。通过拖拽、配置的方式，将各种组件与设备相关的数据源关联，无需编程，即可快速搭建物联网场景下的 web 应用。该项目主要分成工作台和 web 可视化两个模块。我负责的是工作台模块，工作台主要通过编排服务节点提供了业务服务开发的能力。例如设备联动，API 生成（将设备属性发布成一个可被调用的API），设备与服务联动（根据API返回结果控制设备）等。web 可视化模块主要用于快速搭建设备监控页面，提供了设备列表、设备地图等业务组件。

难点

1. 在第一版的物联网应用快速构建项目中，通过操作 dom 来生成组件（服务节点），代码与搭建页面耦合，对于不同类型的组件，需要分别判断类型来生成，右侧配置面板同样如此，当组件类型增多时，代码变得冗余复杂，扩展性很差。
2. 组件 schema 不仅要可以配置属性和静态数据，而且还要支持请求接口获取动态数据。schema 主要由两部分构成，props 表示组件可配置属性，models 表示默认数据（属性值）。每个可配置属性，都有一个 type，用于动态生成表单组件。
3. 原来组件在画布上的移动基于 H5 的 drag 方式，但是当组件拖放到组件时，会出现许多问题，判断逻辑也十分繁琐。
4. 后续的难点在于，页面数据的定义，既要简洁，可快速渲染页面，又要方便后端提取信息，生成服务。

解决方案

1. 采用了 vue 的动态组件，实现了对 html 元素、布局、样式，业务逻辑进行封装，然后再动态渲染出来。对于右侧配置面板，则通过组件 schema 文件来定义，并动态渲染出来。降低代码复杂度，提高可扩展性。组件 schema 是搭建系统和组件之间的规范约定，用于配置面板渲染。
2. 采用 mousedown、mousemove、mouseup 鼠标事件代替 drag 事件，并且采用 transform 代替 绝对布局优化性能。还可以用 [vue-draggable-resizable](https://npm.taobao.org/package/vue-draggable-resizable)